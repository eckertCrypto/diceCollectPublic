(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{117:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));r(5),r(4),r(6),r(7);var n=r(0),c=r(28),o=r(21),d=(r(3),r(74),r(86),r(13),r(226),r(227),r(2),r(41)),l=r(27),f=r(150),h=r(122);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O=function(e,t,r,n){[[-1,0],[1,0],[0,-1],[0,1]].forEach((function(c){var d=Object(o.a)(c,2),l=d[0],f=d[1],h=[e[0]+l,e[1]+f];r.find((function(e){return e[0]==h[0]&&e[1]==h[1]}))||t.find((function(e){return e[0]==h[0]&&e[1]==h[1]}))||n.length&&!n.find((function(e){return e[0]==h[0]&&e[1]==h[1]}))||t.push(h)}))},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[0,0],n=[],c=[r];e[0].position=r;for(var l=t.cubePositions||[],f=1;f<e.length;f++){O(e[f-1].position,n,c,l);var h=e[f],v=d.a.int(n.length),m=n.splice(v,1),y=Object(o.a)(m,1),j=y[0];c.push(j),h.position=j}return e},j=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Math.max(1,d.a.get(e.CUBE_COUNT||w)),r=[],n=Object(c.a)(e.dices||[]),o=0;o<t;o++){var l=d.a.get(e.CUBE_TYPE||x),f={type:l,dice:null};if("normal"==f.type){var v=d.a.get(e.DICE_SELECTION||_);"old"==v&&n&&n.length?f.dice=d.a.pull(n):f.dice=h.a.createDice()}r.push(f)}return y(r,e)},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(m({cubes:j(e),special:d.a.get(e.SPECIALS||E),rarity:d.a.get(e.RARITY||C),maxBreeds:D,breeds:0,uuid:Object(f.a)(),created_at:(new Date).toGMTString()},e),{},{SPECIALS:void 0,RARITY:void 0,CUBE_COUNT:void 0,CUBE_TYPE:void 0,MAX_BREEDS:void 0,dices:void 0,DICE_SELECTION:void 0,exampleTetra:void 0})},w=[3,4,5],E=["red","green","blue","purple"],C=[["normal",80],["rare",15],["legendary",5]],x=[["normal",90],["empty",10]],D=5,_=["new"],A=[["new",20],["old",80]],R=[["new",30],["old",70]],S={createTetra:T,createExamples:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],r=0;r<10;r++)t.push(T(e));return t},craftTooltip:"create new tetra from tetraMats",getCraftChance:function(){var e={mats:{tetra:-10},maxBreeds:D,SPECIALS:E,RARITY:C,CUBE_COUNT:w,CUBE_TYPE:x};return e.exampleTetra=this.createExamples(e),e},craft:function(){var e=l.a.state.user;if(e){var t=T(this.getCraftChance());return e.tetras.push(t),e.mats.tetra-=10,{tetra:t,mats:{tetra:-10}}}},getCraftFromDicesChances:function(e){var t={mats:{tetra:-10},DICE_SELECTION:R,dices:Object(c.a)(e)};return t.exampleTetra=this.createExamples(t),t},craftTetraFromDices:function(e){var t=l.a.state.user;if(t){var r=T(this.getCraftFromDicesChances(e));return t.tetras.push(r),t.mats.tetra-=10,{tetra:r,mats:{tetra:-10}}}},breedTooltip:"select some tetras and create new one with chance to mutate special, rarity, cubeCount and structure",getBreedChances:function(e){var t=e.reduce((function(e,t){return Math.min(e,t.maxBreeds)}),D),r=e.map((function(e){return[e.special,100]}));E.forEach((function(e){r.push([e,10])}));var n=e.map((function(e){return[e.rarity,100]}));C.forEach((function(e){n.push(e)}));var d=e.flatMap((function(e){return e.cubes.map((function(e){return e.dice})).filter((function(e){return!!e}))})),l=e.map((function(e){return[e.cubes.length,100]}));Object(c.a)(l).forEach((function(e){var t=Object(o.a)(e,2),r=t[0];t[1];r>1&&l.push([r-1,20]),r<15&&l.push([r+1,20])}));var f={mats:{tetra:-10},maxBreeds:t,SPECIALS:r,RARITY:n,DICE_SELECTION:A,CUBE_COUNT:l,dices:d};return f.exampleTetra=this.createExamples(f),f},breed:function(e){if(e.length){if(!e.find((function(e){return e.breeds>=e.maxBreeds}))){e.forEach((function(e){return e.breeds++}));var t=T(this.getBreedChances(e));return user.tetras.push(t),user.mats.tetra-=10,{tetra:t,mats:{tetra:-10}}}console.log("already max breeded")}},mergeTooltip:"remove some tetras and use random stats of parents",getMergeChances:function(e){var t=e.reduce((function(e,t){return Math.min(e,t.maxBreeds)}),D),r=e.map((function(e){return[e.special,100]})),n=e.map((function(e){return[e.rarity,100]})),c=e.flatMap((function(e){return e.cubes.map((function(e){return e.dice})).filter((function(e){return!!e}))})),o={mats:{tetra:-10},maxBreeds:t,SPECIALS:r,RARITY:n,DICE_SELECTION:["old"],CUBE_COUNT:e.map((function(e){return[e.cubes.length,100]})),dices:c,cubePositions:e.flatMap((function(e){return e.cubes.map((function(e){return e.position}))}))};return o.exampleTetra=this.createExamples(o),o},merge:function(e){if(e.length){e.forEach(this.remove);var t=T(this.getMergeChances(e));return user.tetras.push(t),user.mats.tetra-=10,{tetra:t,mats:{tetra:-10}}}},getInjectChances:function(e){var t={mats:{tetra:-10},maxBreeds:D,SPECIALS:E,RARITY:C,CUBE_COUNT:w,CUBE_TYPE:x};return t.exampleTetra=this.createExamples(t),t},inject:function(e){if(e.length){e.forEach(this.remove);var t=T(this.getInjectChance(e));return user.tetras.push(t),user.mats.tetra-=10,{tetra:t,mats:{tetra:-10}}}},recycleTooltip:"remove tetras and receive some tetraMats and dices",getRecycleChances:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.getRecycleChances(e)})):{mats:{tetra:5},EARN_DICE_COUNT:[[1,80],[2,20]],dices:e.cubes.map((function(e){return e.dice})).filter((function(e){return!!e}))}},recycle:function(e){var t=this,r=l.a.state.user;if(r){if(Array.isArray(e))return function(e){var t=[],r=[],n={dice:0,tetra:0};return e.forEach((function(e){e.dice&&t.push(e.dice),e.dices&&e.dices.forEach((function(e){return t.push(e)})),e.tetra&&r.push(e.tetra),e.tetras&&e.tetras.forEach((function(e){return r.push(e)})),e.mats&&e.mats.dice&&(n.dice+=e.mats.dice),e.mats&&e.mats.tetra&&(n.tetra+=e.mats.tetra)})),{dices:t.length>1?t:void 0,dice:1==t.length?t[0]:void 0,tetras:r.length>1?r:void 0,tetra:1==r.length?r[0]:void 0,mats:{dice:n.dice?n.dice:void 0,tetra:n.tetra?n.tetra:void 0}}}(e.map((function(e){return t.recycle(e)})));if(this.remove(e)){r.mats.tetra+=5;for(var n=this.getRecycleChances(e),c=d.a.get(n.EARN_DICE_COUNT),o=[],f=0;f<c;f++)n.dices.length&&o.push(d.a.pull(n.dices));return o.forEach((function(e){return r.dices.push(e)})),{dices:o,mats:{tetra:5}}}}},remove:function(e){var t=this,r=l.a.state.user;if(!r)return!1;if(Array.isArray(e))return e.map((function(e){return t.remove(e)}));var n=r.tetras.indexOf(e);return n>=0&&(r.tetras.splice(n,1),!0)}}},122:function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));r(5),r(4),r(2),r(6),r(7);var n=r(21),c=r(28),o=r(0),d=(r(3),r(13),r(74),r(86),r(41)),l=r(27),f=r(150),h=r(117);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O=function(e){var t=[],r=[],n={dice:0,tetra:0};return e.forEach((function(e){e.dice&&t.push(e.dice),e.dices&&e.dices.forEach((function(e){return t.push(e)})),e.tetra&&r.push(e.tetra),e.tetras&&e.tetras.forEach((function(e){return r.push(e)})),e.mats&&e.mats.dice&&(n.dice+=e.mats.dice),e.mats&&e.mats.tetra&&(n.tetra+=e.mats.tetra)})),{dices:t.length>1?t:void 0,dice:1==t.length?t[0]:void 0,tetras:r.length>1?r:void 0,tetra:1==r.length?r[0]:void 0,mats:{dice:n.dice?n.dice:void 0,tetra:n.tetra?n.tetra:void 0}}},y=["red","green","blue","purple"],j=[["normal",80],["rare",15],["legendary",5]],T=[1,2,3,4,5,6],w={createDice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(m({color:d.a.get(e.COLORS||y),rarity:d.a.get(e.RARITY||j),level:d.a.get(e.LEVELS||T),maxBreeds:3,breeds:0,uuid:Object(f.a)(),created_at:(new Date).toGMTString()},e),{},{COLORS:void 0,LEVELS:void 0,RARITY:void 0,exampleDice:void 0,mats:void 0})},createExamples:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],r=0;r<10;r++)t.push(this.createDice(e));return t},craftTooltip:"create new dice from diceMats",getCraftChance:function(){var e={mats:{dice:-10},maxBreeds:3,COLORS:y,RARITY:j,LEVELS:T};return e.exampleDice=this.createExamples(e),e},craft:function(){var e=l.a.state.user;if(e){var t=this.createDice(this.getCraftChance());return e.dices.push(t),e.mats.dice-=10,{dice:t,mats:{dice:-10}}}},breedTooltip:"select some dices and create new one with chance to mutate level and color",getBreedChances:function(e){var t=e.reduce((function(e,t){return Math.min(e,t.maxBreeds)}),3),r=e.map((function(e){return[e.color,50]}));y.forEach((function(e){r.push([e,10])}));var o=e.map((function(e){return e.rarity})),d=e.map((function(e){return[e.level,50]}));Object(c.a)(d).forEach((function(e){var t=Object(n.a)(e,1)[0];d.push([t+1,10]),t>1&&d.push([t-1,10])}));var l={mats:{dice:-10},maxBreeds:t,COLORS:r,RARITY:o,LEVELS:d};return l.exampleDice=this.createExamples(l),l},breed:function(e){var t=l.a.state.user;if(t&&e.length){if(!e.find((function(e){return e.breeds>=e.maxBreeds}))){e.forEach((function(e){return e.breeds++}));var r=this.createDice(this.getBreedChances(e));return t.dices.push(r),t.mats.dice-=10,{dice:r,mats:{dice:-10}}}console.log("already max breeded")}},mergeTooltip:"remove some dices and create new one with chance to mutate rarity",getMergeChances:function(e){var t=e.reduce((function(e,t){return Math.min(e,t.maxBreeds)}),3),r=e.map((function(e){return e.color})),n=e.map((function(e){return[e.rarity,100]}));j.forEach((function(e){n.push(e)}));var c=e.map((function(e){return e.level})),o={mats:{dice:-10},maxBreeds:t,COLORS:r,RARITY:n,LEVELS:c};return o.exampleDice=this.createExamples(o),o},merge:function(e){var t=l.a.state.user;if(t&&e.length){e.forEach(this.remove);var r=this.createDice(this.getMergeChances(e));return t.dices.push(r),t.mats.dice-=10,{dice:r,mats:{dice:-10}}}},combineTooltip:"select & remove some dices and create tetra from it",getCombineChances:function(e){var t=h.a.getCraftFromDicesChances(e);return m(m({},t),{},{mats:m(m({},t.mats),{},{dice:-10})})},combine:function(e){var t=l.a.state.user;if(t){e.forEach(this.remove);var r=h.a.craftTetraFromDices(e);return tetra&&(t.mats.dice-=10),O([r,{mats:{dice:-10}}])}},recycleTooltip:"remove dice and receive some dice mats",getRecycleChances:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.getRecycleChances(e)})):{mats:{dice:5}}},recycle:function(e){var t=this,r=l.a.state.user;if(r)return Array.isArray(e)?O(e.map((function(e){return t.recycle(e)}))):this.remove(e)?(r.mats.dice+=5,{mats:{dice:5}}):void 0},remove:function(e){var t=this,r=l.a.state.user;if(!r)return!1;if(Array.isArray(e))return e.map((function(e){return t.remove(e)}));var n=r.dices.indexOf(e);return n>=0&&(r.dices.splice(n,1),!0)}}},184:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));r(5),r(4),r(2),r(6),r(7);var n=r(28),c=r(21),o=r(98),d=r(0),l=(r(74),r(13),r(30),r(3),r(99)),f=r(10),h=r(150),v=r(27),m=r(67),O=r(76);function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var T,w={uuid:"123",name:"username"},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"areaname",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mine";t=parseInt(t)||8,r=parseInt(r)||6;for(var c=[],o=0;o<r;o++){for(var d=[],l=0;l<t;l++)d.push(-1);c.push(d)}return{name:e,type:n,width:t,height:r,fields:c,owner:C(),uuid:Object(h.a)(),created_at:(new Date).toGMTString(),lastGainTime:(new Date).getTime(),mats:{gold:0,dice:0,tetra:0},matsPerTime:{gold:10,dice:2,tetra:1}}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return j(j({},w),{},{tetrasWithOffset:[],created_at:(new Date).toGMTString()},e)},x={fieldTypes:[-2,-1,0,1,2,3,4],COLORS:{"-2":"transparent","-1":"red",0:"black",1:"black",2:"black",3:"black",4:"black"},BORDER_COLORS:{"-2":"transparent","-1":"red",0:"green",1:"blue",2:"yellow",3:"purple",4:"orange"},state:(T=new f.default({data:function(){return{areas:[],areaUuid:null,loaded:!1}},computed:{area:function(){var e=this;return this.areaUuid&&this.areas&&this.areas.length?this.areas.find((function(a){return a.uuid==e.areaUuid})):null}},methods:{onAreaChanged:function(area){var e=this,t=this.areas.indexOf(area);console.log("onAreaChanged",area,t),this.areasDoc.transact((function(){t>=0&&e.yAreas.delete(t,1),t<0&&Object(o.a)("index"),e.yAreas.insert(t,[area]),console.log("area pushed",area)}))}},watch:{area:{deep:!0,handler:function(a,b){console.log("area changed",a,b,a==b,JSON.stringify(a)!=this._copy);var e=JSON.stringify(a);a&&b&&a==b&&e!=this._copy&&this.onAreaChanged(a),T._copy!=e&&(T._copy=e)}}}}),T.localDataDoc=l.a.create("localDataFieldArea",!1),T.areasDoc=l.a.create("areas"),T.yAreas=T.areasDoc.getArray("areas"),T.yAreas.observe((function(e,t){console.log("areas changed",{event:e,transaction:t}),t.local&&T.areas.length==T.yAreas.length||(T.areas=T.yAreas.toArray().map((function(area){return function(area){var e=E();return O.a.fixObject(area,e),area.fields.length!=area.height&&(area.height=area.fields.length),area.fields[0]&&area.fields[0].length!=area.width&&(area.width=area.fields[0].length),area}(area)})))})),T.yLocalState=T.localDataDoc.getMap("state"),T.yLocalState.observe((function(e,t){t.local&&(T.areaUuid=T.yLocalState.get("areaUuid"))})),T),areas:function(){return this.state.areas},area:function(){return this.state.area},loadArea:function(area){this.state.yLocalState.set("areaUuid",area.uuid)},getAreaState:function(area){var e=this.state,t=area.uuid,r=new f.default({computed:{area:function(){return e.areas.find((function(a){return a.uuid==t}))}},methods:{onAreaChanged:function(area){var t=e.areas.indexOf(area);console.log("onAreaChanged",area,t),e.areasDoc.transact((function(){t>=0&&e.yAreas.delete(t,1),t<0&&Object(o.a)("index"),e.yAreas.insert(t,[area]),console.log("area pushed",area)}))}},watch:{area:{deep:!0,handler:function(a,b){console.log("area changed",a,b,a==b,JSON.stringify(a)!=this._copy);var e=JSON.stringify(a);a&&b&&a==b&&e!=this._copy&&this.onAreaChanged(a),r._copy!=e&&(r._copy=e)}}}});return r},createArea:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=arguments.length>3?arguments[3]:void 0,c=E(e,t,r,n);this.state.yAreas.push([c]),this.loadArea(c)},remove:function(area){var e=this.state.areas.indexOf(this.state.areas.find((function(u){return u.uuid==area.uuid})));e>=0&&this.state.yAreas.delete(e,1)},removeAll:function(){this.state.yAreas.delete(0,this.state.yAreas.length)},getNewMats:function(area){var e=(new Date).getTime(),t=(e-area.lastGainTime)/1e4,r={addToOwner:{},addToMine:{},lockedForFight:{},currentTime:e,lastTime:area.lastGainTime};for(var n in area.matsPerTime)if(Object.hasOwnProperty.call(area.matsPerTime,n)){var c=area.matsPerTime[n],o=parseInt(c*t);r.addToOwner[n]=parseInt(.7*o),r.addToMine[n]=o-parseInt(.7*o),r.lockedForFight[n]=area.mats[n]+o-parseInt(.7*o)}return r},getNewMatsOnFight:function(area){var e=this.getNewMats(area);for(var t in area.matsPerTime)if(Object.hasOwnProperty.call(area.matsPerTime,t)){var r=parseInt(.2*e.lockedForFight[t]);e.addToOwner[t]+=r,e.addToMine[t]-=r,e.lockedForFight[t]-=r}return e},getNewMatsOnPvpFight:function(e,t){return{addToWinner:{pvp:10},addToLooser:{pvp:-3}}},getResources:function(area,e){if(!(e=e||v.a.state.user)||e.uuid!=area.owner.uuid)return!1;var t=this.getNewMats(area);for(var r in area.lastGainTime=(new Date).getTime(),t.addToOwner)Object.hasOwnProperty.call(t.addToOwner,r)&&(e.mats[r]+=t.addToOwner[r],area.mats[r]+=t.addToMine[r]);return t},getLockedResources:function(area,e){if(!(e=e||v.a.state.user)||e.uuid!=area.owner.uuid)return!1;var t=this.getNewMatsOnFight(area);for(var r in area.lastGainTime=(new Date).getTime(),t.addToOwner)Object.hasOwnProperty.call(t.addToOwner,r)&&(e.mats[r]+=t.addToOwner[r],area.mats[r]+=t.addToMine[r]);return t},getHeroResources:function(e,t){e=e||v.a.state.user;var r=v.a.state.users.find((function(u){return u.uuid==t.userUuid}));if(!e||!r)return!1;var n=this.getNewMatsOnPvpFight(e,r);return v.a.changeOtherUser(r,(function(){for(var t in n.addToWinner)Object.hasOwnProperty.call(n.addToWinner,t)&&(e.mats[t]+=n.addToWinner[t],r.mats[t]+=n.addToLooser[t])})),n},attack:function(area,e,t){var r=this.fieldsTypesToFieldsObjects(area.fields),n=this.fieldsWithTetras(r,area.enemy.tetrasWithOffset),o=this.fieldsWithTetras(r,t),d=m.a.randomDiceOnArea(n),l=Object(c.a)(d,2),f=l[0],h=l[1],v=m.a.randomDiceOnArea(o),O=Object(c.a)(v,2),y=O[0],j=O[1],T=m.a.getResult(f),w=m.a.getResult(y),E=w[0]>(T[0]||0);return E&&(area.enemy=C({uuid:e.uuid,name:e.name,tetrasWithOffset:t})),{success:E,mats:E?this.getLockedResources(area,e):null,enemyResult:T,userResult:w,enemyDiceRolls:h,userDiceRolls:j,enemyArea:n,userArea:o,enemyDicedArea:f,userDicedArea:y}},attackHero:function(area,e,t,r){var n=this.fieldsTypesToFieldsObjects(area.fields),o=r.areaUuid==area.uuid?n:this.fieldsTypesToFieldsObjects(r.area.fields),d=this.fieldsWithTetras(o,r.tetrasWithOffset),l=this.fieldsWithTetras(n,t),f=m.a.randomDiceOnArea(d),h=Object(c.a)(f,2),v=h[0],O=h[1],y=m.a.randomDiceOnArea(l),j=Object(c.a)(y,2),T=j[0],w=j[1],E=m.a.getResult(v),C=m.a.getResult(T),x=(C[0]||0)>(E[0]||0);return{success:x,mats:x?this.getHeroResources(e,r):null,enemyResult:E,userResult:C,enemyDiceRolls:O,userDiceRolls:w,enemyArea:d,userArea:l,enemyDicedArea:v,userDicedArea:T}},fieldsTypesToFieldsObjects:function(e){return e.map((function(e){return e.map((function(e){return{type:e}}))}))},fieldsWithTetras:function(e,t){var r=this,area=e.map((function(e){return Object(n.a)(e)}));return t.forEach((function(e){r.addTetraToArea(area,e,(function(t){return{cube:j({},t),tetraWithOffset:e}}))})),area},isValidPositionForTetra:function(e,t){if(!t)return!1;var r=t.tetra?t.tetra:v.a.getTetra(t.tetraUuid,t.userUuid);return!!r&&!r.cubes.find((function(r){var n=t.offset.x+r.position[0],c=t.offset.y+r.position[1];if(!(c>=0&&n>=0&&c<e.length&&n<e[c].length))return!0;var o=e[c][n];return!!(o.type<0||o.cube)}))},addTetraToArea:function(area,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return{cube:t,tetraWithOffset:e}},r=v.a.getTetra(e.tetraUuid,e.userUuid);r&&r.cubes.forEach((function(n){var c=e.offset.x+n.position[0],o=e.offset.y+n.position[1];o>=0&&c>=0&&o<area.length&&c<area[o].length&&(area[o][c]=j(j(j({},area[o][c]),t(n)),{},{hasCube:!0,tetra:r}))}))}}},225:function(e,t,r){var content=r(289);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(78).default)("56b15182",content,!0,{sourceMap:!1})},228:function(e,t,r){var content=r(296);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(78).default)("364e4840",content,!0,{sourceMap:!1})},229:function(e,t,r){var content=r(298);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(78).default)("2c980fd5",content,!0,{sourceMap:!1})},244:function(e,t,r){"use strict";r(288);var n=r(59),component=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body"},[r("Navbar"),e._v(" "),r("Nuxt",{staticClass:"mt-3"})],1)}),[],!1,null,null,null);t.a=component.exports;installComponents(component,{Navbar:r(314).default})},247:function(e,t,r){r(248),e.exports=r(249)},27:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var n,c=r(98),o=(r(3),r(74),r(13),r(2),r(226),r(227),r(30),r(99)),d=r(122),l=r(117),f=r(10),h=r(150),v=r(76),m=r(184),O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"username";return{name:e,dices:[],tetras:[],mats:{gold:1e4,dice:1e4,tetra:1e4,pvp:1e3},uuid:Object(h.a)(),created_at:(new Date).toGMTString(),areas:[]}},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"123";return{uuid:e,tetrasWithOffset:[]}},j={state:(n=new f.default({data:function(){return{users:[],userUuid:null,loaded:!1}},computed:{user:function(){var e=this;return this.userUuid&&this.users&&this.users.length?this.users.find((function(a){return a.uuid==e.userUuid})):null}},methods:{onUserChanged:function(e){var t=this,r=this.users.indexOf(e);console.log("onUserChanged",e,r),this.usersDoc.transact((function(){r>=0&&t.yUsers.delete(r,1),r<0&&Object(c.a)("index"),t.yUsers.insert(r,[e]),console.log("user pushed",e)}))}},watch:{user:{deep:!0,handler:function(a,b){console.log("user changed",a,b,a==b,JSON.stringify(a)!=this._copy),a&&b&&a==b&&JSON.stringify(a)!=this._copy&&this.onUserChanged(a),this._copy=JSON.stringify(a)}}}}),n.localDataDoc=o.a.create("localData",!1),n.usersDoc=o.a.create("users"),n.yUsers=n.usersDoc.getArray("users"),n.yUsers.observe((function(e,t){t.local&&n.users.length==n.yUsers.length||(n.users=n.yUsers.toArray().map((function(e){return function(e){var t=O(),r=y(),n=d.a.createDice(),c=l.a.createTetra();return console.log("fix user",JSON.parse(JSON.stringify(e))),v.a.fixObject(e,t),e.areas.forEach((function(area){return v.a.fixObject(area,r)})),e.dices.forEach((function(e){return v.a.fixObject(e,n)})),console.log("fix tetras",JSON.parse(JSON.stringify(e))),e.tetras.forEach((function(e){v.a.fixObject(e,c),e.cubes.forEach((function(e){e.dice&&v.a.fixObject(e.dice,n)}))})),e}(e)})))})),n.yLocalState=n.localDataDoc.getMap("state"),n.yLocalState.observe((function(e,t){console.log(t),n.userUuid&&!t.local||(n.userUuid=n.yLocalState.get("userUuid"))})),n),users:function(){return this.state.users},user:function(){return this.state.user},loadUser:function(e){this.state.yLocalState.set("userUuid",e.uuid)},createUser:function(e){var t=O(e);this.state.yUsers.push([t]),this.loadUser(t)},changeOtherUser:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},n=this.state.users.indexOf(e);console.log("change and save other user",e,n),this.state.usersDoc.transact((function(){n>=0&&t.state.yUsers.delete(n,1),r(e),n<0&&Object(c.a)("index"),t.state.yUsers.insert(n,[e]),console.log("user pushed",e)}))},remove:function(e){var t=this.state.users.indexOf(this.state.users.find((function(u){return u.uuid==e.uuid})));t>=0&&this.state.yUsers.delete(t,1)},removeAll:function(){this.state.yUsers.delete(0,this.state.yUsers.length)},getTetra:function(e,t){return this.state.users&&(t||this.state.user)?(t?this.state.users.find((function(u){return u.uuid==t})):this.state.user).tetras.find((function(t){return t.uuid==e})):null},getArea:function(e){if(!this.state.user)return null;var t=this.state.user.areas.find((function(t){return t.uuid==e}));return t||(t=y(e),this.state.user.areas.push(t)),t},getAllEnemyHeroes:function(e){if(!this.state.users)return null;if(!e&&!this.state.user)return null;var t=e||this.state.user.uuid,r={};return m.a.state.areas.filter((function(a){return"hero"==a.type})).forEach((function(a){return r[a.uuid]=a})),this.state.users.filter((function(u){return u.uuid!=t})).flatMap((function(e){return e.areas.filter((function(area){return!!r[area.uuid]&&area.tetrasWithOffset.length})).map((function(area){return{userUuid:e.uuid,userName:e.name,area:r[area.uuid],areaUuid:area.uuid,areaName:r[area.uuid].name,tetrasWithOffset:area.tetrasWithOffset}}))}))}}},288:function(e,t,r){"use strict";r(225)},289:function(e,t,r){var n=r(77)(!1);n.push([e.i,"body{background-color:#191919;color:#fff}body pre{color:hsla(0,0%,100%,.8)}.modal-content{background-color:#454545}",""]),e.exports=n},295:function(e,t,r){"use strict";r(228)},296:function(e,t,r){var n=r(77)(!1);n.push([e.i,".navbar-dark .navbar-nav .nav-link.nuxt-link-active{color:#fff}",""]),e.exports=n},297:function(e,t,r){"use strict";r(229)},298:function(e,t,r){var n=r(77)(!1);n.push([e.i,".user-info[data-v-e7828b8a]{position:fixed;bottom:0;right:0;background:#6c757d;cursor:pointer}.body .user-info pre[data-v-e7828b8a]{color:hsla(0,0%,100%,.8)}",""]),e.exports=n},314:function(e,t,r){"use strict";r.r(t);var n=r(27),c={methods:{load:function(e){n.a.loadUser(e)},create:function(){var e=prompt("please enter your name");e&&n.a.createUser(e)}},computed:{users:function(){return n.a.users()},user:function(){return n.a.user()}}},o=(r(295),r(59)),component=Object(o.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark"}},[r("b-container",[r("b-navbar-brand",{attrs:{to:"/"}},[e._v("DiceCollect")]),e._v(" "),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e._v(" "),r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[r("b-navbar-nav",[r("b-nav-item",{attrs:{to:"/user"}},[e._v("User")]),e._v(" "),r("b-nav-item",{attrs:{to:"/dice"}},[e._v("Dice")]),e._v(" "),r("b-nav-item",{attrs:{to:"/tetra"}},[e._v("Tetra")]),e._v(" "),r("b-nav-item",{attrs:{to:"/area"}},[e._v("Area Editor")]),e._v(" "),r("b-nav-item",{attrs:{to:"/mine"}},[e._v("Mine")]),e._v(" "),r("b-nav-item",{attrs:{to:"/hero"}},[e._v("Hero")])],1),e._v(" "),r("b-navbar-nav",[r("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[r("em",[e._v("User: "+e._s(e.user?e.user.name:"-"))])]},proxy:!0}])},[e._v(" "),r("b-dropdown-item",{staticStyle:{"background-color":"#00ff00"},on:{click:e.create}},[e._v("+ Create New User +")]),e._v(" "),e._l(e.users,(function(t){return r("b-dropdown-item",{key:t.name,on:{click:function(r){return e.load(t)}}},[e._v(e._s(t.name))])}))],2)],1)],1)],1)],1),e._v(" "),r("UserInfo")],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{UserInfo:r(315).default})},315:function(e,t,r){"use strict";r.r(t);r(5),r(4),r(2),r(6),r(3),r(7);var n=r(0),c=r(27);function o(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?o(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):o(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var l={data:function(){return{show:!0}},computed:{user:function(){var e=c.a.user();return e?d(d({},e),{},{dices:e.dices.length,tetras:e.tetras.length,areas:e.areas?e.areas.length:0}):e}}},f=(r(297),r(59)),component=Object(f.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-info p-2 rounded border shadow",on:{click:function(t){e.show=!e.show}}},[e.user?r("h5",[e._v("Current User: "+e._s(e.user.name))]):e._e(),e._v(" "),e.user&&e.show?r("pre",[e._v(e._s(JSON.stringify(e.user,null,2)))]):e._e()])}),[],!1,null,"e7828b8a",null);t.default=component.exports},41:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(86),r(74);var n={int:function(e){return parseInt(Math.random()*e)},pull:function(e){if(!e.length)return null;if(Array.isArray(e[0])){var t=this.getRandomWithChance(e),r=e.indexOf(t);return r>=0&&e.splice(r,1),t[0]}var n=this.getRandom(e),c=e.indexOf(n);return c>=0&&e.splice(c,1),n},get:function(e){if(!e.length)return null;if(Array.isArray(e[0])){var t=this.getRandomWithChance(e);return t?t[0]:null}return this.getRandom(e)},getRandom:function(e){return e[Math.min(Math.floor(Math.random()*e.length),e.length-1)]},getRandomWithChance:function(e){var t=e.reduce((function(e,t){return e+t[1]}),0),r=Math.min(Math.floor(Math.random()*t),t-1);return e.find((function(a){return(r-=a[1])<0}))}}},67:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));r(5),r(4),r(2),r(6),r(7);var n=r(0),c=(r(13),r(3),r(86),function(e,element){var t=e.indexOf(element);return t>=0&&(e.splice(t,1),!0)}),o=r(41);function d(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f={normal:0,rare:2,legendary:9},h={getLowestRoll:function(e){return e.reduce((function(e,t){return e?t.dice.maxLevel-t.dice.level>e.dice.maxLevel-e.dice.level?t:e:t}),null)},rollDice:function(e){for(var t=e.maxLevel||e.level,r=o.a.int(t)+1,n=0;n<f[e.rarity];n++){var c=o.a.int(t)+1;r=Math.max(r,c)}return l(l({},e),{},{level:r,maxLevel:t})},rerollTetra:function(e,t,r){var n=this.getLowestRoll(e.diceRolls),o=this.rollDice(n.dice),d=n.x,l=n.y,f={dice:o,x:d,y:l};f.dice.level>n.dice.level&&(c(e.diceRolls,n),t.push(f),e.diceRolls.push(f),r[l][d].cube.dice=o)},addTetraBonus:function(e,t,r){e.diceRolls=e.diceRolls.map((function(n){if(n.dice.color==e.tetra.special){var c=n.x,o=n.y,d=n.dice,f={x:c,y:o,dice:l(l({},d),{},{level:2*d.level,maxLevel:2*d.maxLevel})};return t.push(f),r[o][c].cube.dice=f.dice,f}return n}))},randomDiceOnArea:function(area){var e=this,t=[],r={},n=area.map((function(n,c){return n.map((function(n,o){var d=l({},n);if(n.cube&&n.cube.dice){var f=e.rollDice(n.cube.dice),h={dice:f,x:o,y:c};t.push(h),d.cube=l(l({},n.cube),{},{dice:f});var v=n.tetra.uuid;r[v]?r[v].diceRolls.push(h):r[v]={tetra:n.tetra,diceRolls:[h]}}return d}))}));for(var c in r)if(Object.hasOwnProperty.call(r,c)){for(var o=r[c],d=o.tetra,h=0;h<f[d.rarity];h++)this.rerollTetra(o,t,n);this.addTetraBonus(o,t,n)}return[n,t]},getResult:function(area){var e={};return area.forEach((function(t,r){return t.forEach((function(t,r){t.cube&&t.cube.dice&&(e[t.type]||(e[t.type]=0),e[t.type]+=t.cube.dice.level)}))})),e}}},76:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(37),c={fixObject:function(object,template){if(object&&template){for(var e in template)if(Object.hasOwnProperty.call(template,e)){var element=template[e];void 0===element&&void 0!==object[e]?delete object[e]:void 0===element||e in object&&Object(n.a)(object[e])==Object(n.a)(element)?element&&"object"===Object(n.a)(element)&&!Array.isArray(element)&&object[e]&&"object"===Object(n.a)(object[e])&&this.fixObject(object[e],element):(console.log("fix key",JSON.parse(JSON.stringify({key:e,element:element,object:object,typeInObject:Object(n.a)(object[e]),typeInTemplate:Object(n.a)(element)}))),object[e]=JSON.parse(JSON.stringify(element)))}for(var t in object)!Object.hasOwnProperty.call(object,t)||Object.hasOwnProperty.call(template,t)&&void 0!==template[t]||delete object[t]}}}},99:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(246),c=r(243),o=r(54),d={create:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"test-pw",d=new o.a;return d._indexeddb=new n.a(e,d),d._indexeddb.on("synced",(function(){console.log("content from the database is loaded"),d._loaded=!0})),t&&(d._webrtc=new c.a(e,d,{password:r})),d}}}},[[247,29,5,30]]]);