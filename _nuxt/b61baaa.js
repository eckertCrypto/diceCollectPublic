(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{334:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));r(5),r(4),r(2),r(7),r(8);var n=r(27),o=r(28),c=r(42),l=r(0),f=(r(76),r(15),r(30),r(3),r(168)),d=r(11),h=r(179),v=r(35),y=r(49);function O(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?O(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):O(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var w={rollDice:function(e,t){var r=y.a.int(e.level)+1;if("rare"==e.rarity)for(var n=0;n<2;n++){var o=y.a.int(e.level)+1;r=Math.max(r,o)}if("legendary"==e.rarity)for(var c=0;c<9;c++){var l=y.a.int(e.level)+1;r=Math.max(r,l)}return m(m({},e),{},{level:r,maxLevel:e.level})},randomDiceOnArea:function(area){var e=this,t=[],r={};return[area.map((function(n,o){return n.map((function(n,c){var l=m({},n);if(n.cube&&n.cube.dice){var f=e.rollDice(n.cube.dice,n.tetraWithOffset),d={dice:f,x:c,y:o};t.push(d),l.cube=m(m({},n.cube),{},{dice:f});var h=n.tetra.uuid;r[h]?r[h].diceRolls.push(d):r[h]={tetra:n.tetra,diceRolls:[d]}}return l}))})),t]},getResult:function(area){var e={};return area.forEach((function(t,r){return t.forEach((function(t,r){t.cube&&t.cube.dice&&(e[t.type]||(e[t.type]=0),e[t.type]+=t.cube.dice.level)}))})),e}};function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var A,D={uuid:"123",name:"username"},k=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"areaname",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mine",o=[],c=0;c<r;c++){for(var l=[],f=0;f<t;f++)l.push(-1);o.push(l)}return{name:e,type:n,width:t,height:r,fields:o,owner:S(),uuid:Object(h.a)(),created_at:(new Date).toGMTString()}},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _(_({},D),{},{tetrasWithOffset:[],created_at:(new Date).toGMTString()},e)},P=function e(object,template){for(var t in console.log("fix",{object:object,template:template}),template)if(Object.hasOwnProperty.call(template,t)){var element=template[t];void 0===element||t in object&&Object(c.a)(object[t])==Object(c.a)(element)?element&&"object"===Object(c.a)(element)&&object[t]&&"object"===Object(c.a)(object[t])&&e(object[t],element):(console.log("fix",{key:t,element:element}),object[t]=JSON.parse(JSON.stringify(element)))}},T=function(e){e.areaUuid&&e.areas.length||(e.area=null);var area=e.areas.find((function(area){return area.uuid==e.areaUuid}));area!=e.area&&(e._copy=JSON.stringify(area),e.area=area),window.area=e.area},x={fieldTypes:[-2,-1,0,1,2,3,4],COLORS:{"-2":"transparent","-1":"red",0:"black",1:"black",2:"black",3:"black",4:"black"},BORDER_COLORS:{"-2":"transparent","-1":"red",0:"green",1:"blue",2:"yellow",3:"purple",4:"orange"},state:(A=new d.default({data:function(){return{areas:[],areaUuid:null,area:null,loaded:!1}},methods:{onAreaChanged:function(area){var e=this,t=this.areas.indexOf(area);console.log("onAreaChanged",area,t),this.areasDoc.transact((function(){t>=0&&e.yAreas.delete(t,1),e.yAreas.push([area]),console.log("area pushed",area)}))}},watch:{area:{deep:!0,handler:function(a,b){console.log("area changed",a,b,a==b,JSON.stringify(a)!=this._copy),a&&b&&a==b&&JSON.stringify(a)!=this._copy&&this.onAreaChanged(a)}}}}),A.localDataDoc=f.a.create("localDataFieldArea",!1),A.areasDoc=f.a.create("areas"),A.yAreas=A.areasDoc.getArray("areas"),A.yAreas.observe((function(){A.areas=A.yAreas.toArray().map((function(area){return function(area){var e=k();return P(area,e),area}(area)})),T(A)})),A.yLocalState=A.localDataDoc.getMap("state"),A.yLocalState.observe((function(){A.areaUuid=A.yLocalState.get("areaUuid"),T(A)})),A),areas:function(){return this.state.areas},area:function(){return this.state.area},loadArea:function(area){this.state.yLocalState.set("areaUuid",area.uuid)},createArea:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=arguments.length>3?arguments[3]:void 0,o=k(e,t,r,n);this.state.yAreas.push([o]),this.loadArea(o)},remove:function(area){var e=this.state.areas.indexOf(this.state.areas.find((function(u){return u.uuid==area.uuid})));e>=0&&this.state.yAreas.delete(e,1)},removeAll:function(){this.state.yAreas.delete(0,this.state.yAreas.length)},attack:function(area,e,t){if(!area.owner||area.owner.uuid==D.uuid)return area.owner=S({uuid:e.uuid,name:e.name,tetrasWithOffset:t}),{success:!0};var r=this.fieldsTypesToFieldsObjects(area.fields),n=this.fieldsWithTetras(r,area.owner.tetrasWithOffset),c=this.fieldsWithTetras(r,t),l=w.randomDiceOnArea(n),f=Object(o.a)(l,2),d=f[0],h=f[1],v=w.randomDiceOnArea(c),y=Object(o.a)(v,2),O=y[0],m=y[1],j=w.getResult(d),_=w.getResult(O),A=_[0]>j[0];return A&&(area.owner=S({uuid:e.uuid,name:e.name,tetrasWithOffset:t})),{success:A,ownerResult:j,userResult:_,ownerDiceRolls:h,userDiceRolls:m,ownerArea:n,userArea:c}},fieldsTypesToFieldsObjects:function(e){return e.map((function(e){return e.map((function(e){return{type:e}}))}))},fieldsWithTetras:function(e,t){var r=this,area=e.map((function(e){return Object(n.a)(e)}));return t.forEach((function(e){r.addTetraToArea(area,e,(function(t){return{cube:_({},t),tetraWithOffset:e}}))})),area},isValidPositionForTetra:function(e,t){if(!t)return!1;var r=t.tetra?t.tetra:v.a.getTetra(t.tetraUuid,t.userUuid);return!!r&&!r.cubes.find((function(r){var n=t.offset.x+r.position[0],o=t.offset.y+r.position[1];if(!(o>=0&&n>=0&&o<e.length&&n<e[o].length))return!0;var c=e[o][n];return!!(c.type<0||c.cube)}))},addTetraToArea:function(area,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return{cube:t,tetraWithOffset:e}},r=v.a.getTetra(e.tetraUuid,e.userUuid);r&&r.cubes.forEach((function(n){var o=e.offset.x+n.position[0],c=e.offset.y+n.position[1];c>=0&&o>=0&&c<area.length&&o<area[c].length&&(area[c][o]=_(_(_({},area[c][o]),t(n)),{},{hasCube:!0,tetra:r}))}))}}},346:function(e,t,r){"use strict";r.r(t);var n=r(334),o={data:function(){return{width:8,height:6,type:"mine",types:["mine","enemy"]}},methods:{load:function(area){n.a.loadArea(area),this.$emit("input",area)},create:function(){var e=prompt("please enter a name for the area");e&&n.a.createArea(e,this.width,this.height,this.type)},remove:function(area){n.a.remove(area)},removeAll:function(){n.a.removeAll()}},computed:{areas:function(){return n.a.areas()},area:function(){return n.a.area()}}},c=r(59),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("h3",[e._v("Areas")]),e._v(" "),r("b-row",{staticClass:"my-3"},[r("b-col",{attrs:{cols:"auto"}},[r("b-button",{attrs:{variant:"success"},on:{click:e.create}},[e._v("\n        Create New Area\n      ")])],1),e._v(" "),r("b-col",{attrs:{cols:"auto"}},[r("label",[e._v("Size:")])]),e._v(" "),r("b-col",{attrs:{cols:"1"}},[r("b-input",{attrs:{type:"number",title:"Width"},model:{value:e.width,callback:function(t){e.width=t},expression:"width"}})],1),e._v(" "),r("b-col",{attrs:{cols:"auto"}},[r("label",[e._v("x")])]),e._v(" "),r("b-col",{attrs:{cols:"1"}},[r("b-input",{attrs:{type:"number",title:"Height"},model:{value:e.height,callback:function(t){e.height=t},expression:"height"}})],1),e._v(" "),r("b-col",{attrs:{cols:"auto"}},[r("label",[e._v("Type:")])]),e._v(" "),r("b-col",{attrs:{cols:"2"}},[r("b-select",{attrs:{options:e.types},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1)],1),e._v(" "),e._l(e.areas,(function(area){return r("b-row",{key:area.name,staticClass:"mb-1"},[r("b-col",{staticClass:"ml-auto",attrs:{cols:"auto"}},[r("b-button",{on:{click:function(t){return e.load(area)}}},[e._v("Edit")])],1),e._v(" "),r("b-col",{staticClass:"my-auto"},[e._v(e._s(area.type)+" "+e._s(area.width)+"x"+e._s(area.height)+": "+e._s(area.name)+"\n    ")]),e._v(" "),r("b-col",{staticClass:"my-auto",staticStyle:{color:"gray","font-size":"smaller"}},[e._v(e._s(area.created_at)+"\n    ")]),e._v(" "),r("b-col",{staticClass:"ml-auto",attrs:{cols:"auto"}},[r("b-button",{attrs:{variant:"danger"},on:{click:function(t){return e.remove(area)}}},[e._v("Remove")])],1)],1)})),e._v(" "),e.areas.length?r("b-row",{staticClass:"mt-3"},[r("b-col",{staticClass:"ml-auto",attrs:{cols:"auto"}},[r("b-button",{attrs:{variant:"danger"},on:{click:e.removeAll}},[e._v("Remove All Areas")])],1)],1):e._e()],2)}),[],!1,null,null,null);t.default=component.exports}}]);