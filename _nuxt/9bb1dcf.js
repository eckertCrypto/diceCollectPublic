(window.webpackJsonp=window.webpackJsonp||[]).push([[2,15],{324:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));r(113);var n,o=r(164),d=r(11),f=r(304),l=function(t,e,r,n){for(var o=[],d=0;d<r;d++){for(var l=[],h=0;h<e;h++)l.push(-1);o.push(l)}return{name:t,type:n,width:e,height:r,fields:o,uuid:Object(f.a)(),created_at:(new Date).toGMTString()}},h=function(t){t.areaUuid&&t.areas.length||(t.area=null);var area=t.areas.find((function(area){return area.uuid==t.areaUuid}));area!=t.area&&(t.area=area),window.area=t.area},c={fieldTypes:[-2,-1,0,1,2,3,4],COLORS:{"-2":"transparent","-1":"red",0:"black",1:"black",2:"black",3:"black",4:"black"},BORDER_COLORS:{"-2":"transparent","-1":"red",0:"green",1:"blue",2:"yellow",3:"purple",4:"orange"},state:(n=new d.default({data:function(){return{areas:[],areaUuid:null,area:null,loaded:!1}},methods:{onAreaChanged:function(area){var t=this,e=this.areas.indexOf(area);console.log("onAreaChanged",area,e),this.areasDoc.transact((function(){e>=0&&t.yAreas.delete(e,1),t.yAreas.push([area]),console.log("area pushed",area)}))}},watch:{area:{deep:!0,handler:function(a,b){console.log("area changed",a,b,a==b,JSON.stringify(a)!=JSON.stringify(b)),a&&b&&a==b&&this.onAreaChanged(a)}}}}),n.localDataDoc=o.a.create("localDataFieldArea",!1),n.areasDoc=o.a.create("areas"),n.yAreas=n.areasDoc.getArray("areas"),n.yAreas.observe((function(){n.areas=n.yAreas.toArray(),h(n)})),n.yLocalState=n.localDataDoc.getMap("state"),n.yLocalState.observe((function(){n.areaUuid=n.yLocalState.get("areaUuid"),h(n)})),n),areas:function(){return this.state.areas},area:function(){return this.state.area},loadArea:function(area){this.state.yLocalState.set("areaUuid",area.uuid)},createArea:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=arguments.length>3?arguments[3]:void 0,o=l(t,e,r,n);this.state.yAreas.push([o]),this.loadArea(o)},remove:function(area){var t=this.state.areas.indexOf(this.state.areas.find((function(u){return u.uuid==area.uuid})));t>=0&&this.state.yAreas.delete(t,1)},removeAll:function(){this.state.yAreas.delete(0,this.state.yAreas.length)},getTetra:function(t){return this.state.area?this.state.area.tetras.find((function(e){return e.uuid==t})):null}}},331:function(t,e,r){var content=r(340);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(72).default)("42c03454",content,!0,{sourceMap:!1})},334:function(t,e,r){"use strict";r.r(e);r(6),r(5),r(2),r(7),r(8);var n=r(35),o=r(33),d=r(0),f=(r(43),r(113),r(3),r(175),r(17),r(324)),l=r(30),h=r(40),c=(r(13),r(31),r(20),r(11)),v=window,x=document.body,w=document.documentElement,m=function(t,e,r){var n=t.className.split(/\s+/),o=n.indexOf(r);"add"===e&&-1==o?(n.push(r),t.className=n.join(" ")):"remove"===e&&-1!=o&&(n.splice(o,1),t.className=n.join(" "))},y=function(t){var e=Math.max(0,v.pageXOffset||w.scrollLeft||x.scrollLeft||0)-(w.clientLeft||0),r=Math.max(0,v.pageYOffset||w.scrollTop||x.scrollTop||0)-(w.clientTop||0);return{x:t?Math.max(0,t.pageX||t.clientX||0)-e:0,y:t?Math.max(0,t.pageY||t.clientY||0)-r:0}},_=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{gridSize:null};Object(l.a)(this,t),this.state=new c.default.observable({isOverDropzone:!1,hoverOffset:{x:0,y:0},isDragging:!1,dragUuid:null,stoneIndex:null,clickItem:null,dragItem:null,startClickPosition:{x:0,y:0}}),this.options=r,this.dropzone=e,this.__onPress=this._onPress.bind(this),this.__onRelease=this._onRelease.bind(this),this.__onMove=this._onMove.bind(this),window.addEventListener("mousedown",this.__onPress,!0),window.addEventListener("touchstart",this.__onPress,!0),window.addEventListener("mouseup",this.__onRelease,!0),window.addEventListener("touchend",this.__onRelease,!0),window.addEventListener("mousemove",this.__onMove,!0),window.addEventListener("touchmove",this.__onMove,!0)}return Object(h.a)(t,[{key:"destroy",value:function(){window.removeEventListener("mousedown",this.__onPress,!0),window.removeEventListener("touchstart",this.__onPress,!0),window.removeEventListener("mouseup",this.__onRelease,!0),window.removeEventListener("touchend",this.__onRelease,!0),window.removeEventListener("mousemove",this.__onMove,!0),window.removeEventListener("touchmove",this.__onMove,!0)}},{key:"_onPress",value:function(t){if(t&&t.target){var e=t.target.closest(".stone");if(!e)return;var r=t.target.closest(".draggable");if(!r)return;window.tetra=r,window.stone=e,t.preventDefault(),this.state.isDragging=!0,this.state.dragUuid=r.dataset.id,this.state.stoneIndex=(n=e,Array.prototype.indexOf.call(n.parentNode.childNodes,n)),this.state.startClickPosition=y(t),this._makeDragItem(r),this._onMove(t)}var n}},{key:"_onRelease",value:function(t){this.state.isDragging=!1,this._trashDragItem()}},{key:"_onMove",value:function(t){if(this.state.dragItem&&this.state.isDragging){t.preventDefault();var e=y(t);if(this._refreshItemPosition(this.state.dragItem,e.x-this.state.startClickPosition.x,e.y-this.state.startClickPosition.y),function(t,e,r){var n=t.getBoundingClientRect(),o=e>n.left&&e<n.left+n.width,d=r>n.top&&r<n.top+n.height;return o&&d}(this.dropzone,e.x,e.y)){this.state.isOverDropzone=!0;var r=function(t,e,r){var n=t.getBoundingClientRect();return{x:e-n.left,y:r-n.top}}(this.dropzone,e.x,e.y),n=this.options.gridSize;n&&(r.x=parseInt(r.x/n),r.y=parseInt(r.y/n));var o=this.state.hoverOffset,d=o.x,f=o.y;d==r.x&&f==r.y||(this.state.hoverOffset=r),this.state.dragItem.style.opacity="0.1"}else this.state.isOverDropzone=!1,this.state.dragItem.style.opacity="1"}}},{key:"_refreshItemPosition",value:function(t,e,r){t.style["-webkit-transform"]="translateX( "+e+"px ) translateY( "+r+"px )",t.style["-moz-transform"]="translateX( "+e+"px ) translateY( "+r+"px )",t.style["-ms-transform"]="translateX( "+e+"px ) translateY( "+r+"px )",t.style.transform="translateX( "+e+"px ) translateY( "+r+"px )"}},{key:"_makeDragItem",value:function(t){this._trashDragItem(),this.state.clickItem=t,this._container=t.parentNode,m(this.state.clickItem,"add","active"),this.state.dragItem=document.createElement(t.tagName),this.state.dragItem.className="dragging",this.state.dragItem.innerHTML=t.innerHTML,this.state.dragItem.style.position="absolute",this.state.dragItem.style["z-index"]="999",this.state.dragItem.style.left=(t.offsetLeft||0)+"px",this.state.dragItem.style.top=(t.offsetTop||0)+"px",this.state.dragItem.style.width=(t.offsetWidth||0)+"px",this.state.dragItem.style.height=(t.offsetHeight||0)+"px",this.state.dragItem.style.cursor="default",this._container.appendChild(this.state.dragItem)}},{key:"_trashDragItem",value:function(){this.state.dragItem&&this.state.clickItem&&(m(this.state.clickItem,"remove","active"),this.state.clickItem=null,this._container.removeChild(this.state.dragItem),this.state.dragItem=null)}}]),t}(),O=function(t,e){return new _(t,e)},D=r(73);function T(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function S(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?T(Object(source),!0).forEach((function(e){Object(d.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):T(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var A={props:["fields","tetrasWithOffset","userUuid"],data:function(){return{fieldSize:40,borderSize:2,dragState:{},hoverTetraUuid:null}},mounted:function(){this._dragAndDrop=O(this.$refs.element,{gridSize:this.fieldDistance}),this.dragState=this._dragAndDrop.state},beforeDestroy:function(){this._dragAndDrop.destroy()},watch:{"dragState.isDragging":function(t,e){!t&&e&&this.dropTetra(this.draggingTetra)}},methods:{mouseOver:function(t,e){var r=this;if(e&&t.tetraWithOffset){var n=t.tetraWithOffset.tetraUuid;this._clearHover&&clearTimeout(this._clearHover),this._clearHover=setTimeout((function(){return r.hoverTetraUuid=n}),50)}else this._clearHover=setTimeout((function(){return r.hoverTetraUuid=null}),50)},isMouseOver:function(t){return this.hoverTetraUuid&&t.tetraWithOffset&&this.hoverTetraUuid==t.tetraWithOffset.tetraUuid},fieldStyle:function(t,e,r){return{width:this.fieldSize+"px",height:this.fieldSize+"px","background-color":f.a.COLORS[t],border:"2px solid "+f.a.BORDER_COLORS[t],top:r*this.fieldDistance+"px",left:e*this.fieldDistance+"px",position:"absolute"}},isValidPositionForTetra:function(area,t){return!!t&&!t.tetra.cubes.find((function(e){var r=t.offset.x+e.position[0],n=t.offset.y+e.position[1];if(!(n>=0&&r>=0&&n<area.length&&r<area[n].length))return!0;var o=area[n][r];return!!(o.type<0||o.cube)}))},addTetraToArea:function(area,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return{cube:t}},r=D.a.getTetra(t.tetraUuid,t.userUuid);r.cubes.forEach((function(r){var n=t.offset.x+r.position[0],o=t.offset.y+r.position[1];o>=0&&n>=0&&o<area.length&&n<area[o].length&&(area[o][n]=S(S(S({},area[o][n]),e(r)),{},{hasCube:!0}))}))},removeTetra:function(t){if(t.tetraWithOffset){var e=this.tetrasWithOffset.indexOf(t.tetraWithOffset);e>=0&&this.tetrasWithOffset.splice(e,1)}},dropTetra:function(t){if(t){var e=t.tetraUuid,r=t.offset;t.isValid&&this.tetrasWithOffset.push({tetraUuid:e,offset:r,userUuid:this.userUuid})}}},computed:{fieldAreaBase:function(){return console.log("compute fieldAreaBase"),this.fields.map((function(t){return t.map((function(t){return{type:t}}))}))},fieldAreaWithTetras:function(){var t=this;if(this.tetrasWithOffset&&this.tetrasWithOffset.length){var area=this.fieldAreaBase.map((function(t){return Object(o.a)(t)}));return this.tetrasWithOffset.forEach((function(e){t.addTetraToArea(area,e,(function(t){return{cube:t,tetraWithOffset:e}}))})),area}return this.fieldAreaBase},fieldAreaWithDraggingTetra:function(){if(this.dragState.isDragging&&this.draggingTetra&&this.draggingTetra.tetra){var area=this.fieldAreaWithTetras.map((function(t){return Object(o.a)(t)})),t=this.draggingTetra;return this.addTetraToArea(area,t,(function(e){return t.isValid?{dragCube:e,dragTetraWithOffset:t}:{invalidDragCube:e,dragTetraWithOffset:t}})),area}return this.fieldAreaWithTetras},fieldArea:function(){return console.log("compute fieldArea",this.fieldAreaWithDraggingTetra),this.fieldAreaWithDraggingTetra},dragData:function(){var t=this.dragState,e=t.dragUuid,r=t.stoneIndex;if(!e)return null;var n=D.a.getTetra(e,this.userUuid);return{cube:r>=0&&r<n.cubes.length?n.cubes[r]:null,tetraUuid:e,tetra:n}},draggingTetra:function(){return this.draggingTetraWithOffset?S(S({},this.draggingTetraWithOffset),{},{isValid:this.isValidPositionForTetra(this.fieldAreaWithTetras,this.draggingTetraWithOffset)}):null},draggingTetraWithOffset:function(){if(this.dragState.isOverDropzone&&this.dragState.hoverOffset&&this.dragData&&this.dragData.tetra&&this.dragData.cube){var t=this.dragState.hoverOffset,e=t.x,r=t.y,o=Object(n.a)(this.dragData.cube.position,2);return{offset:{x:e-o[0],y:r-o[1]},tetra:this.dragData.tetra,tetraUuid:this.dragData.tetraUuid}}return null},fieldDistance:function(){return this.fieldSize+this.borderSize},areaWidth:function(){return this.fields.reduce((function(t,e){return Math.max(t,e.length)}),0)},areaHeight:function(){return this.fields.length},containerStyle:function(){return{width:this.areaWidth*this.fieldDistance-this.borderSize+"px",height:this.areaHeight*this.fieldDistance-this.borderSize+"px",position:"relative"}},widthStyle:function(){return{width:this.areaWidth*this.fieldDistance-this.borderSize+"px"}}}},k=A,I=(r(349),r(56)),component=Object(I.a)(k,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{style:t.widthStyle},[r("div",{ref:"element",style:t.containerStyle},t._l(t.fieldArea,(function(e,n){return r("div",{key:"row"+n},t._l(e,(function(e,o){return r("div",{key:"field"+n+"_"+o,style:t.fieldStyle(e.type,o,n),on:{mouseover:function(r){return t.mouseOver(e,!0)},mouseleave:function(r){return t.mouseOver(e,!1)},click:function(e){return t.$emit("fieldClick",[o,n])}}},[e.hasCube?r("div",{staticClass:"field-wrapper",class:{hover:t.isMouseOver(e)},staticStyle:{width:"100%",height:"100%"},on:{click:function(r){return t.removeTetra(e)}}},[e.cube?r("SimpleCube",{staticStyle:{opacity:"1"},attrs:{cube:e.cube}}):t._e(),t._v(" "),e.dragCube?r("SimpleCube",{staticStyle:{opacity:"0.8"},attrs:{cube:e.dragCube}}):t._e(),t._v(" "),e.invalidDragCube?r("SimpleCube",{staticStyle:{opacity:"0.3"},attrs:{cube:e.invalidDragCube}}):t._e()],1):t._e()])})),0)})),0)])}),[],!1,null,"67415c33",null);e.default=component.exports;installComponents(component,{SimpleCube:r(345).default})},339:function(t,e,r){"use strict";r(331)},340:function(t,e,r){var n=r(71)(!1);n.push([t.i,'.glowing[data-v-4baa956d]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;border:0 solid #fff;box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0;background-color:rgba(0,0,0,.7);z-index:-1}.rare .glowing[data-v-4baa956d]:before{background-color:hsla(0,0%,75.3%,.7)}.legendary .glowing[data-v-4baa956d]:before{background-color:rgba(255,215,0,.7)}.red .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px red,inset 0 0 5px red}.blue .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #003cff,inset 0 0 5px #003cff}.green .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}.yellow .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #e5ff00,inset 0 0 5px #e5ff00}.orange .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #f60,inset 0 0 5px #f60}.purple .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #90f,inset 0 0 5px #90f}.white .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #fff,inset 0 0 5px #fff}.gray .glowing[data-v-4baa956d]:before{box-shadow:0 0 10px #777,inset 0 0 5px #777}.smallGlow .red .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px red,inset 0 0 5px red}.smallGlow .blue .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #003cff,inset 0 0 5px #003cff}.smallGlow .green .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #0f0,inset 0 0 5px #0f0}.smallGlow .yellow .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #e5ff00,inset 0 0 5px #e5ff00}.smallGlow .orange .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #f60,inset 0 0 5px #f60}.smallGlow .purple .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #90f,inset 0 0 5px #90f}.smallGlow .white .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #fff,inset 0 0 5px #fff}.smallGlow .gray .glowing[data-v-4baa956d]:before{box-shadow:0 0 4px #777,inset 0 0 5px #777}@-webkit-keyframes glowAnimation-data-v-4baa956d{0%{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}20%{box-shadow:0 0 15px #0f0,inset 0 0 10px #0f0}40%{box-shadow:0 0 12px #0f0,inset 0 0 8px #0f0}60%{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}80%{box-shadow:0 0 8px #0f0,inset 0 0 3px #0f0}to{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}}@keyframes glowAnimation-data-v-4baa956d{0%{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}20%{box-shadow:0 0 15px #0f0,inset 0 0 10px #0f0}40%{box-shadow:0 0 12px #0f0,inset 0 0 8px #0f0}60%{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}80%{box-shadow:0 0 8px #0f0,inset 0 0 3px #0f0}to{box-shadow:0 0 10px #0f0,inset 0 0 5px #0f0}}.reflection[data-v-4baa956d]{-webkit-box-reflect:below 0 linear-gradient(transparent,transparent,rgba(0,0,0,.411))}.cube__face[data-v-4baa956d]{width:100%;height:100%;color:#fff;text-align:center;font-size:20px}.legendary .cube__face[data-v-4baa956d],.rare .cube__face[data-v-4baa956d]{color:#000}.draggable .cube__face--front[data-v-4baa956d]{cursor:move}.cube__face--front[data-v-4baa956d]{transform:rotateY(0deg) translateZ(21px)}',""]),t.exports=n},341:function(t,e,r){var content=r(350);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(72).default)("f271bdb4",content,!0,{sourceMap:!1})},345:function(t,e,r){"use strict";r.r(e);var n=r(0),o={props:["cube"],methods:{diceClass:function(t){return t?Object(n.a)({rare:"rare"==t.rarity,legendary:"legendary"==t.rarity},t.color,!0):{white:!0}}},computed:{stone:function(){return{cube:this.cube,text:this.cube.dice?this.cube.dice.level:"",class:this.diceClass(this.cube.dice)}}}},d=(r(339),r(56)),component=Object(d.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:t.stone.class,staticStyle:{width:"100%",height:"100%",padding:"3px"}},[r("div",{staticClass:"cube__face glowing cube__face--front"},[t._v("\n    "+t._s(t.stone.text)+"\n  ")])])}),[],!1,null,"4baa956d",null);e.default=component.exports},349:function(t,e,r){"use strict";r(341)},350:function(t,e,r){var n=r(71)(!1);n.push([t.i,".field-wrapper[data-v-67415c33]{transition:transform .4s ease;cursor:pointer;position:relative}.field-wrapper.hover[data-v-67415c33]{transform:scale(1.3)}.field-wrapper>*[data-v-67415c33]{position:absolute;top:0;left:0}",""]),t.exports=n}}]);